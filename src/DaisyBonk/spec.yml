  name: daisyrogue
  region: nyc
  alerts:
    - rule: DEPLOYMENT_FAILED
    - rule: DOMAIN_FAILED
  features:
    - buildpack-stack=ubuntu-22

  ingress:
    rules:
      - component:
          name: client
        match:
          path:
            prefix: /

  services:
    # 1️⃣ Authoritative WebSocket Server
    - name: auth-server
      environment_slug: node-js
      github:
        repo: T-A-B/DaisyRogue
        branch: master
        deploy_on_push: true
      source_dir: /
      run_command: node server_auth.js
      http_port: 8081
      instance_count: 1
      instance_size_slug: apps-s-1vcpu-1gb
      routes:
        - path: /ws
          preserve_path_prefix: true
      envs:
        - key: NODE_ENV
          value: production

    # 2️⃣ Main Backend Server
  - name: ws-server
    environment_slug: node-js
    github:
      repo: T-A-B/DaisyRogue
      branch: master
      deploy_on_push: true
    source_dir: src/DaisyBonk
    run_command: node server.js
    http_port: 8080           # DO injects $PORT automatically
    instance_size_slug: apps-s-1vcpu-1gb
    instance_count: 1

    # 3️⃣ Client Frontend
    - name: client
      environment_slug: node-js
      github:
        repo: T-A-B/DaisyRogue
        branch: master
        deploy_on_push: true
      source_dir: client
      run_command: node serve.js
      http_port: 3000
      instance_count: 1
      instance_size_slug: apps-s-1vcpu-1gb
      envs:
        - key: NODE_ENV
          value: production
      routes:
        - path: /